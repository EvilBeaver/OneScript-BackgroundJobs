
Процедура ПередСборкой(Знач РабочийКаталог) Экспорт

	КаталогБинарников = Новый Файл(ОбъединитьПути(РабочийКаталог,"bin")).ПолноеИмя;
	ФС.ОбеспечитьПустойКаталог(КаталогБинарников);
	
	Процесс = СоздатьПроцесс("msbuild ../BackgroundJobs/BackgroundJobs.sln /t:restore;Build;PackForHub /p:Configuration=Release /p:TargetFramework=net452 /p:OspxTarget="""+КаталогБинарников+"""",
		,Истина);
	Процесс.Запустить();
	Пока Не Процесс.Завершен Цикл
		Вывести(Процесс.ПотокВывода);
		Вывести(Процесс.ПотокОшибок);
	КонецЦикла;
	
	Вывести(Процесс.ПотокВывода);
	Вывести(Процесс.ПотокОшибок);
	
	Если Процесс.КодВозврата <> 0 Тогда
		ВызватьИсключение "Сборка проекта завершена с ошибкой";
	КонецЕсли;

КонецПроцедуры

Процедура Вывести(Поток)
	Текст = Поток.Прочитать();
	Если ЗначениеЗаполнено(Текст) Тогда
		Сообщить(Текст);
	КонецЕсли;
КонецПроцедуры

Описание.Имя("BackgroundJobs")
	.Версия("0.1.0")
	.Автор("Юрий Дешин")
	.Описание("Фоновые задания для 1Script")
	.ВерсияСреды("1.0.19")
	.ВключитьФайл("bin")
	.ВключитьФайл("package-loader.os")
	;